# 지표수집과 모니터링

해당 내용은 [대용량 서비스를 위한 아키텍처](https://fastcampus.app/courses/205143) 강의를 듣고 공부한 내용입니다.

## 지표수집
> 서비스가 제대로 동작하고 있는지 파악하는 지표

지표는 서비스에서의 지표와, 서비스 노드 지표 크게 두가지로 구분할 수 있다. 

</br>

### 서비스 지표

* **API call 수**

현재 요청중인 api call 수가 어떻게 되는지, 그중 몇개가 성공하고 몇개가 실패하고 있는지를 나타내는 지표.
실패의 비중이 너무 많다면 에러의 종류는 db 혹은 없는 페이지를 찾는 에러인지가 구분이 되어야 한다. 

* **API Latency**

Latency는 일반적으로 평균값이 아닌 중간값을 본다. 예를들어 latency 1초와 0.01초가 있으면 평균값은 0.5 정도가 된다. 때문에 중간값이 얼마인지가 더 중요하다.
또 중간값 뿐만 아니라 90%, 95%, 99% 유저는 몇 초 안에 응답을 받는다 등의 범위를 나눠서 체크하는 것이 필요하다. 

</br>

### 서비스 노드 지표

* **서버의 상태 (잘 살아있는지)**
* **CPU 사용량 (DB 및 API 서버, Cache 서버의 CPU 사용량)**
* **메모리 사용량 (oom, swap 방지)**
* **디스크 사용량**
* **네트워크 사용량 (파일이나 데이터의 전송량은?)**
* **현재 동작중인 정상적인 서버의 수**

</br>

## 모니터링
> prometheus, grafana, sentry 등

이러한 서비스 지표들을 수집하고 시각화 하기 위해 일반적으로 prometheus로 지표를 수집하고 grafana로 시각화한다.    
에러 로그 수집의 경우 sentry를 사용하여 수집하고 급감 및 에러가 튀고 있는 현상, 혹은 새로운 서비스가 문제없이 동작하는지 등을 을 파악할 수 있다.    
또 수집한 지표를 바탕으로 서버의 디스크가 95% 이상이 되면 알람을 보내는 등의 설정도 가능하다. (slack 등 메신저로 알리는 등)
알람의 경우 등급을 나누어서 긴급 대응해야 할 이슈인지, 아닌지를 판별하게 하는 것이 좋다. 
