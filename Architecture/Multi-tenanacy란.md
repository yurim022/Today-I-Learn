# Multi Tenancy

새로운 프로젝트를 진행하면서 이번 프로젝트는 '멀티 테넌시' 아키텍처를 사용한다는 요구사항을 받았다. 그런데...멀티 테넌시가 뭐지.   

> 단일 소프트웨어 인스턴스로 서로 다른 여러 사용자 그룹(tenant)에 서비스를 제공하는 아키텍처

![image](https://user-images.githubusercontent.com/45115557/198045109-5c2c0242-b1a2-4fdd-b6a9-f5502590115f.png)

## 사용 예시

* 웹메일 서비스 

여기서 중요한 것은 **각 사용자가 독립적으로 이용할 수 있어야** 한다는 점이다. 웹메일에 접속했는데 모든 사용자의 메일이 하나의 메일함에서 보인다면 아무도 사용하지 않을테니까!   

* **SaaS(Software-as-a-Service)**
* **클라우드 컴퓨팅에서 서로 다른 고객이 서버 리소스를 나누어 사용하는 공유 호스팅**

</br>

## 멀티 테넌시 장단점

### 장점

* 비용

다양한 고객 간에 컴퓨팅 및 스토리지 리소스를 공유하여 운영비용을 절감할 수 있다. 

* 확장

수요와 사용량이 증가함에 따라 탄력적으로 확장되어 고객이 확장성 한도에 도달하지 않도록 한다. 반면 단일 테넌트 아키텍처에서는 사용량 증가에 따라 고객에 따라 추가 하드웨어를 구입하거나 더 큰 가상 머신으로 업그레이드 해야 한다. 

* 업그레이드 및 유지 관리

새 버전의 소프트웨어를 사용할 수 있으면 클라우드에서 실행되는 단일 인스턴스에 적용되고 모든 고객이 업그레이드 된다. 반면 단일 아키텍처에서는 서비스 공급자가 고객 하나하나 업그레이드 해주어야 한다. 반면 업데이트를 하고 싶지 않은 고객도 업그레이드 되는 불편함도 있다. 

</br>

### 단점

* 성능

동일한 CPU가 많은 사이클(공유)을 소비하므로 대기가 길어져 응답 시간이 느릴 수 있다. 또한 리소스를 많이 잡아 먹는 서비스가 있을 경우 다른 서비스의 자원까지 써버릴 수 있다. 

* 다운 타임

여러 리소스 요청으로 다운될 수 있다. 

* 보안

논리적으로 분리되어 있지만 물리적으로 분리되어 있지 않기 때문에 데이터 보안문제가 생길 수 있다. 

</br>

## Multi Tenancy Architecture

멀티 테넌시 아키텍처는 복잡성과 비용에 따라 세 가지 유형으로 나눌 수 있다. 

![image](https://user-images.githubusercontent.com/45115557/198054141-c814a404-b143-476c-b0fc-3016487cd3a8.png)

> 단일 애플리케이션, 공유 데이터베이스 스키마

공유 리소스 사용으로 **상대적으로 비용이 저렴**한 가장 단순한 형태의 다중 테넌시 모델이다. 단일 애플리케이션과 단일 데이터베이스 인스턴스를 사용하여 테넌트를 호스팅하고 데이터를 저장한다.
**모든 것을 공유** 하는 모델이며, 모든 리소스는 모든 테넌트 간에 동일하게 공유된다. 사용자 간의 데이터 공유로 인해 **비지니스 위험**이 발생 할 수 있고, **백업 및 복원 기능의 범위가 제한적**이며, **로드밸런싱 및 배포가 복잡**하다. 

</br>

> 단일 애플리케이션, 다중 데이터베이스 스키마

다중 스키마가 있는 단일 데이터베이스를 사용한다. 이 모델에는 다중 테넌트가 있지만 데이터베이스는 각 고객에게 할당된 고유ID로 식별되는 테넌트에 대해 개별적이다. **개별 데이터베이스를 관리하기 위한 오버헤드로 인해 높은 비용**이 발생된다.    
이러한 종류의 아키텍처는 테넌트가 지리적으로 분산되어 있고, 지리적 규정에 따라 다른 테넌트의 데이터를 다르게 취급해야 하는 경우에 유용하다. 

</br>

> 다중 애플리케이션, 다중 데이터베이스 스키마

관리 및 유지 비용이 많이 들기 때문에 복잡한 모델이다. **여러 스키마 및 제한 사항이 데이터베이스 수준에서 구현**되어 더 폐쇠적인 상호작용을 갘는 서비스에 적합하다. 


</br></br>


참고 링크:    
https://www.itworld.co.kr/news/101255   
https://velog.io/@jeb1225/Multi-Tenancy   
https://gguljaem.tistory.com/entry/%EB%A9%80%ED%8B%B0-%ED%85%8C%EB%84%8C%EC%8B%9CMulti-tenancy%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90
